{% extends 'base.twig' %}

{% block content %}
<section id="searchBlock">
    <header class="row">
        <div class="medium-12 columns">
            <h2 class="text-center ">Recherche d'une partie</h2>
        </div>
    </header>
    <main class="row">
        <div id="searchgameBlock" class="hidden medium-5 columns callout">
            <a id="searchgame" class="btn">Recherche d'une partie</a>
        </div>

        <div id="searchgameleaveBlock" class="medium-5 columns callout">
            <a id="searchgameleave" class="btn">Quitter la recherche d'une partie</a>
        </div>
    </main>
</section>

<section id="boardBlock" class="hidden">
    <div id="screen" class="medium-6 columns">
        <div id="boards">
        </div>
    </div>
    <div id="boardsMessage" class="medium-6 columns">
        {% include 'chat/chat.inc.twig' %}
    </div>
</section>
{% endblock %}

{% block javascript %}
<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
<script>
    var socket = io();

    Interactive.searchGame();

    searchgame.addEventListener('click', Interactive.searchGame);
    searchgameleave.addEventListener('click', Interactive.searchGameLeave);

    socket.on('game find', function(msg){

        searchBlock.classList.add('hidden');
        boardBlock.classList.remove('hidden');

        Game.init();

        Online.online = true;

        Game.addPlayer('boussad');
        Game.addPlayer('gabriel');
    });

    socket.on('game action', function(action){
        action = JSON.parse(action);

        if(action.action == 'ChangeCaseValue') {

            Game.getBoard().setCasePlayer(null, action);
            Game.alternatePlayer();

        }
        else if(action.action == 'pushMessage'){

            pushMessage(action);

        }
        else if(action.action == 'leaveGame'){

            pushMessage(action);

        }

    });

    var socket = io();
    chat('game');

    window.addEventListener('beforeunload', Interactive.beforeleavePage);
    window.addEventListener('unload', Interactive.leavePage);

</script>
{% endblock %}
